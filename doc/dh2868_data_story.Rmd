---
title: "Beatles data_story"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The Bealtes have been a household name for decades. 
They are regarded by many as one of the great rock bands of all time, but what was it that made them so popular? 
Perhaps some exploratory data analysis might provide an answer.


Let's load our necessary, packages first.
```{r}
library(tidyverse)
library(tm)
library(wordcloud)
library(tidytext)
library(ggplot2)
library(syuzhet)
library(plotly)
library(data.table)
```
Then we shall load our processed lyrics. 
```{r}
load("../output/processed_lyrics.RData")

artists <- read.csv("/Users/david/Desktop/AppliedDS/proj1/Spring2020-Project1-luthierman-master/data/artists.csv")
```


For this analysis, I'm focusing on the beatles within the larger subgroup of rock artists.  
I'm splitting the data into beatles and non-beatles (formed around the same time) for comparison and contrast.

```{r}

artists_60_70s<- artists %>% 
  filter(Formed %in% c(1960:1970)) %>% 
  select(Artist)

bealtes_lyrics <- dt_lyrics %>% 
  filter(artist =="beatles" & genre == "Rock")

other_lyrics <- dt_lyrics %>% 
  filter(artist %in% artists_60_70s$Artist & genre == "Rock" & artist != "beatles") 
```

Next, I'll convert the given stemmed words into a corpus and then a term document matrix, since the data was already processed and cleaned.

```{r}
# Created a function to streamline conversion to term document matrix

stem_to_tdm <- function(x){
  source <- VectorSource(x)
  corpus <- VCorpus(source)
  return (TermDocumentMatrix(corpus))
}
# respective term document matrices
beatles.tdm <- stem_to_tdm(beatles_lyrics$stemmedwords)
other.tdm <- stem_to_tdm(other_lyrics$stemmedwords)
#beatles.tdm <- removeSparseTerms(beatles.tdm, 0.99) # remove lower frequency terms
#other.tdm <- removeSparseTerms(other.tdm, 0.99) # remove lower frequency terms

# Conveting TDMs into dataframes of most frequent terms

# beatles
m.beatles <- as.matrix(beatles.tdm)
f.b <- sort(rowSums(m.beatles), decreasing=T)
beatles.word_freq<- data.frame(word= names(f.b), freq=f.b)

# other
m.other <- as.matrix(other.tdm)
f.other <- sort(rowSums(m.other), decreasing=T)
other.word_freq<- data.frame(word= names(f.other), freq=f.other)
```

Here are the respective word clouds.

```{r}
# wordcloud for beatles
set.seed(1)
wordcloud(words = beatles.word_freq$word, freq =beatles.word_freq$freq, max.words = 100, random.order=FALSE,
          colors=brewer.pal(8, "Dark2"))

# wordcloud for other
set.seed(1)
wordcloud(words = other.word_freq$word, freq =other.word_freq$freq, max.words = 100, random.order=FALSE,  
          colors=brewer.pal(8, "Dark2"))

```

Without evern looking at any quantitative summaries, it's clear that "love" is the most dominant word in both Beatles and Other rock groups.



```{r}
# top 20 terms
head(beatles.word_freq, 20)
head(other.word_freq, 20)
```


Based on the top twenty words in the respective dataframes, it seems that there is little difference between the most used words from Beatles lyrics and those of other rock groups of the sixties/seventies. 

The words for the most part seem synonymous with similar frequencies; though there is an exception for "cry" (possibly invoking a negative sentiment) which is the 10th most used word in the Beatles lyrics and 20th in other bands.


The relative frequency in the bar plots, table, boxplots and piecharts indicate there is some difference in the distributions of the Beatles words. Overall, the Beatles seem to have a relatively higher count of words than other over their respective data sets (bar plots and relative frequency table), but the distribution of other seems to have wider variation with more values being spread out amongst higher values.

```{r}

# summation of all frequencies for each group
n1<-sum(beatles.word_freq$freq)
n2<-sum(other.word_freq$freq) 

# relative frequencies  for each group
beatles.rf20 <- round(head(beatles.word_freq$freq, 20)/n1, 3)
other.rf20 <- round(head(other.word_freq$freq, 20)/n2, 3)

# relative frequency table
data.table(cbind(beatles.rf20, other.rf20))


# barplots with 
barplot(beatles.rf20, las = 1,names.arg = head(beatles.word_freq$word, 20), col = rainbow(50), horiz = T )
barplot(other.rf20, las = 2,names.arg = head(other.word_freq$word, 20), col = rainbow(50),horiz = T )

```


```{r}


# piecharts 

#please note that the proportions in these pie charts are based on the number of frequencies in the top 20 words, not the whole data set

plot_ly(head(beatles.word_freq, 20 ), labels= ~word, values = ~freq, type = "pie") %>% 
  layout(title = 'Beatles Top 20 Words in Lyrics',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
  
plot_ly(head(other.word_freq,20) , labels= ~word, values = ~freq, type = "pie") %>% 
  layout(title = 'Other Rock Bands Top 20 Words in Lyrics',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
```




```{r}
x<- beatles.word_freq$freq
y<- other.word_freq$freq

#plot(x, col = "blue")
#points(y, col = "red")

#plot(x/n1, col = "blue")
#points(y/n2, col = "red")

# frequency boxplot 
boxplot(x, y, xlab = "Word Frequency Boxplot", ylab= "Frequency", names = c("Beatles", "Other"), horizontal = T)

# relative frequency boxplot
boxplot(x/n1, y/n2,xlab = "Word Relative Frequency Boxplot", ylab = "Relative Frequency",names = c("Beatles", "Other"), horizontal = T)
```


Sentiment analysis using "afinn" lexicon

```{r}
beatles.word_freq %>% 
  inner_join(get_sentiments("afinn")) %>%
  group_by(word) %>% 
  ggplot(aes(x = value, y = freq)) + 
  geom_bar(stat = "identity", alpha = 0.8)

  
```



```{r}
beatles.sentiments <- get_nrc_sentiment(beatles_lyrics$stemmedwords)
```


